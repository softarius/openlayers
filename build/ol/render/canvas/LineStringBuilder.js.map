{"version":3,"file":"LineStringBuilder.js","sources":["../../../../src/ol/render/canvas/LineStringBuilder.js"],"sourcesContent":["/**\r\n * @module ol/render/canvas/LineStringBuilder\r\n */\r\nimport CanvasInstruction, {strokeInstruction, beginPathInstruction} from './Instruction.js';\r\nimport CanvasBuilder from './Builder.js';\r\n\r\nclass CanvasLineStringBuilder extends CanvasBuilder {\r\n  /**\r\n   * @param {number} tolerance Tolerance.\r\n   * @param {import(\"../../extent.js\").Extent} maxExtent Maximum extent.\r\n   * @param {number} resolution Resolution.\r\n   * @param {number} pixelRatio Pixel ratio.\r\n   * @param {boolean} overlaps The replay can have overlapping geometries.\r\n   * @param {?} declutterTree Declutter tree.\r\n   */\r\n  constructor(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree) {\r\n    super(tolerance, maxExtent, resolution, pixelRatio, overlaps, declutterTree);\r\n  }\r\n\r\n  /**\r\n   * @param {Array<number>} flatCoordinates Flat coordinates.\r\n   * @param {number} offset Offset.\r\n   * @param {number} end End.\r\n   * @param {number} stride Stride.\r\n   * @private\r\n   * @return {number} end.\r\n   */\r\n  drawFlatCoordinates_(flatCoordinates, offset, end, stride) {\r\n    const myBegin = this.coordinates.length;\r\n    const myEnd = this.appendFlatCoordinates(\r\n      flatCoordinates, offset, end, stride, false, false);\r\n    const moveToLineToInstruction = [CanvasInstruction.MOVE_TO_LINE_TO, myBegin, myEnd];\r\n    this.instructions.push(moveToLineToInstruction);\r\n    this.hitDetectionInstructions.push(moveToLineToInstruction);\r\n    return end;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  drawLineString(lineStringGeometry, feature) {\r\n    const state = this.state;\r\n    const strokeStyle = state.strokeStyle;\r\n    const lineWidth = state.lineWidth;\r\n    if (strokeStyle === undefined || lineWidth === undefined) {\r\n      return;\r\n    }\r\n    this.updateStrokeStyle(state, this.applyStroke);\r\n    this.beginGeometry(lineStringGeometry, feature);\r\n    this.hitDetectionInstructions.push([\r\n      CanvasInstruction.SET_STROKE_STYLE,\r\n      state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin,\r\n      state.miterLimit, state.lineDash, state.lineDashOffset\r\n    ], beginPathInstruction);\r\n    const flatCoordinates = lineStringGeometry.getFlatCoordinates();\r\n    const stride = lineStringGeometry.getStride();\r\n    this.drawFlatCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);\r\n    this.hitDetectionInstructions.push(strokeInstruction);\r\n    this.endGeometry(lineStringGeometry, feature);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  drawMultiLineString(multiLineStringGeometry, feature) {\r\n    const state = this.state;\r\n    const strokeStyle = state.strokeStyle;\r\n    const lineWidth = state.lineWidth;\r\n    if (strokeStyle === undefined || lineWidth === undefined) {\r\n      return;\r\n    }\r\n    this.updateStrokeStyle(state, this.applyStroke);\r\n    this.beginGeometry(multiLineStringGeometry, feature);\r\n    this.hitDetectionInstructions.push([\r\n      CanvasInstruction.SET_STROKE_STYLE,\r\n      state.strokeStyle, state.lineWidth, state.lineCap, state.lineJoin,\r\n      state.miterLimit, state.lineDash, state.lineDashOffset\r\n    ], beginPathInstruction);\r\n    const ends = multiLineStringGeometry.getEnds();\r\n    const flatCoordinates = multiLineStringGeometry.getFlatCoordinates();\r\n    const stride = multiLineStringGeometry.getStride();\r\n    let offset = 0;\r\n    for (let i = 0, ii = ends.length; i < ii; ++i) {\r\n      offset = this.drawFlatCoordinates_(flatCoordinates, offset, ends[i], stride);\r\n    }\r\n    this.hitDetectionInstructions.push(strokeInstruction);\r\n    this.endGeometry(multiLineStringGeometry, feature);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  finish() {\r\n    const state = this.state;\r\n    if (state.lastStroke != undefined && state.lastStroke != this.coordinates.length) {\r\n      this.instructions.push(strokeInstruction);\r\n    }\r\n    this.reverseHitDetectionInstructions();\r\n    this.state = null;\r\n    return super.finish();\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc.\r\n   */\r\n  applyStroke(state) {\r\n    if (state.lastStroke != undefined && state.lastStroke != this.coordinates.length) {\r\n      this.instructions.push(strokeInstruction);\r\n      state.lastStroke = this.coordinates.length;\r\n    }\r\n    state.lastStroke = 0;\r\n    super.applyStroke(state);\r\n    this.instructions.push(beginPathInstruction);\r\n  }\r\n}\r\n\r\n\r\nexport default CanvasLineStringBuilder;\r\n"],"names":["super","const","let"],"mappings":"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"}